<!doctype html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1"/>
<link rel="shortcut icon" href= "/favicon.png"/>
<link rel="stylesheet" href="/css/style.css"/>
<link rel="stylesheet" href="/css/highlight.css"/>
<script src="/js/lib/modernizr-shiv.js"></script>
    
    <meta name="description" content="2014-09-25补充：Zepto的文档中其实是对return false有说明的：

Iterate through every element of the collection. Inside the iterator function, this keyword refers to the current item (also passed as the second argument to the function). If the iterator function returns false, iteration stops.

是我疏忽了。不过可以把本文当做$.fn.each方法实现的探讨吧。
原文：
前几天在用Zepto做一个项目，同事写了一个小插件，代码的作用是找到某个父元素下的所有img标签，然后将其中lazyload属性的值赋给src属性，达到控制加载图片的目的。
首先想到的，当然是这样实现：

    
        $('img').each(function(idx, el){
            if(!$(el).attr('lazyload')) return false;
            // do something here
        });
    


看代码第二行的return false，这行会导致执行流跳出each循环。"/>

    <title> Zepto中$.fn.each的一个要注意的地方 </title>
</head>
<body>
    <header class="head u-cf">
        <a class="head-flag" href="/">
    <img class="head-flag-img" src="/image/logo.png" alt="sunaiwen 个人博客"/>
</a>
<div id="j-searchBox" class="head-search">
    <button id="j-search-closeBtn" class="head-search-close"><i class="fa fa-close"></i></button>
    <form action="//google.com/search" method="get" accept-charset="utf-8">
        <input id="j-searchScope" type="hidden" name="q" value="http://blog.snwin.co"/>
        <input class="head-search-input" type="search" name="q" placeholder="搜索本站文章..."/>
        <button class="head-search-btn" type="submit"><i class="fa fa-search"></i></button>
    </form>
    <script>
        var scopeInput = document.getElementById('j-searchScope');
        scopeInput.value = 'site:' + scopeInput.value.replace(/^https?:\/\//, '');
    </script>
</div>
<nav class="head-nav">
    <a class="head-nav-item" href="/">首页</a>
    <a class="head-nav-item" href="/archives">归档</a>
    <a class="head-nav-item" href="/about">关于我</a>
    <a id="j-nav-searchBtn" class="head-nav-item hni-search" href="javascript:void(0)"><i class="fa fa-search"></i></a>
</nav>
    </header>
    <main class="main u-cf block">
        
    <section class="main-article">
        
<article class="article  is-articleFull ">
    <header class="article-head">
        
            <h1 class="article-title">Zepto中$.fn.each的一个要注意的地方</h1>
        
        <ul class="article-meta">
            <li class="article-meta-item">
                <i class="fa fa-clock-o ami-icon"></i>
                <span class="ami-text">2014-09-23</span>
            </li>
            <li class="article-meta-item">
                
                    <i class="fa fa-book ami-icon"></i>
                    
                        
                            <a class="ami-text" href="/categories/JavaScript/">JavaScript</a>
                        
                    
                
            </li>
            <li class="article-meta-item">
                
                    <i class="fa  fa-tag  ami-icon"></i>
                    
                        
                            <a class="ami-text" href="/tags/Zepto/">Zepto</a>&nbsp;
                        
                    
                
            </li>
        </ul>
    </header>
    
        <div class="article-content essay"><p><strong>2014-09-25补充：</strong><br>Zepto的文档中其实是对<code>return false</code>有说明的：</p>
<blockquote>
<p>Iterate through every element of the collection. Inside the iterator function, this keyword refers to the current item (also passed as the second argument to the function). <strong>If the iterator function returns false, iteration stops.</strong></p>
</blockquote>
<p>是我疏忽了。不过可以把本文当做<code>$.fn.each</code>方法实现的探讨吧。</p>
<p><strong>原文：</strong></p>
<p>前几天在用Zepto做一个项目，同事写了一个小插件，代码的作用是找到某个父元素下的所有<code>img</code>标签，然后将其中<code>lazyload</code>属性的值赋给<code>src</code>属性，达到控制加载图片的目的。</p>
<p>首先想到的，当然是这样实现：</p>
<pre class="language-javascript">
    <code>
        $('img').each(function(idx, el){
            if(!$(el).attr('lazyload')) return false;
            // do something here
        });
    </code>
</pre>

<p>看代码第二行的<code>return false</code>，这行会导致执行流跳出each循环。</p>
<a id="more"></a>
<p>翻了一下Zepto的相关源码，看到以下的代码：</p>
<pre class="language-javascript">
    <code>
    each: function(callback){
      emptyArray.every.call(this, function(el, idx){
        return callback.call(el, idx, el) !== false
      })
      return this
    }
    </code>
</pre>

<p>发现其实是利用Array类的<code>every</code>方法实现循环。但是<code>every</code>方法有个特点，如果callback返回的值是<code>false</code>或者可以转换为false，every方法立马就会停止循环，返回结果为false。</p>
<p>所以，当以上传入<code>each</code>的callback中返回的值是布尔值<code>false</code>，就会导致<code>return callback.call(el, idx, el) !== false</code>结果为<code>false</code>，从而导致each循环提前结束。</p>
<p>综上，如果传入each方法的callback中返回布尔值<code>false</code>，可能会导致each循环提前跳出。<br>我觉得这并不是一个bug，只是一种控制手段。但是，Zepto在文档中却没说明这点，就略坑了点。</p>
</div>
    
</article>

        
    <footer class="pagination pagination--post u-cf">
        
            <a class="pagination-item" href="/2014/09/25/2014-09-25-kuai-su-huo-qu-tu-pian-kuan-gao/">
                <i class="fa fa-angle-left u-hightLightText"></i>
                
                    上一篇：快速获取图片宽高
                
            </a>
        
        
            <a class="pagination-item" href="/2014/09/19/2014-09-19-22sui-la/">
                
                    下一篇：22岁啦
                
                <i class="fa fa-angle-right u-hightLightText"></i>
            </a>
        
        
            <span class="pagination-break u-hightLightText">&bullet;</span>
        
    </footer>

        
            
                <div class="ds-thread" data-thread-key="1411484501000" data-title="Zepto中$.fn.each的一个要注意的地方" data-url="2014/09/23/2014-09-23-zeptozhong-dot-fn-dot-eachde-yi-ge-yao-zhu-yi-de-di-fang/"></div>
            
        
    </section>

        <aside class="main-aside">
    <section class="main-aside-section aside">
        <h1 class="aside-title">分类</h1>
        <ul class="aside-list">
            
                <li class="aside-list-item">
                    <a class="ali-text u-cf" href="/categories/JavaScript/">JavaScript&nbsp;<span class="ali-count u-hightLightText">10</span></a>
                </li>
            
                <li class="aside-list-item">
                    <a class="ali-text u-cf" href="/categories/英语透析阅读/">英语透析阅读&nbsp;<span class="ali-count u-hightLightText">5</span></a>
                </li>
            
                <li class="aside-list-item">
                    <a class="ali-text u-cf" href="/categories/用户体验/">用户体验&nbsp;<span class="ali-count u-hightLightText">1</span></a>
                </li>
            
                <li class="aside-list-item">
                    <a class="ali-text u-cf" href="/categories/说说/">说说&nbsp;<span class="ali-count u-hightLightText">7</span></a>
                </li>
            
                <li class="aside-list-item">
                    <a class="ali-text u-cf" href="/categories/Web-基础/">Web 基础&nbsp;<span class="ali-count u-hightLightText">1</span></a>
                </li>
            
                <li class="aside-list-item">
                    <a class="ali-text u-cf" href="/categories/CSS/">CSS&nbsp;<span class="ali-count u-hightLightText">3</span></a>
                </li>
            
                <li class="aside-list-item">
                    <a class="ali-text u-cf" href="/categories/读后感/">读后感&nbsp;<span class="ali-count u-hightLightText">1</span></a>
                </li>
            
                <li class="aside-list-item">
                    <a class="ali-text u-cf" href="/categories/Git/">Git&nbsp;<span class="ali-count u-hightLightText">1</span></a>
                </li>
            
                <li class="aside-list-item">
                    <a class="ali-text u-cf" href="/categories/设计/">设计&nbsp;<span class="ali-count u-hightLightText">1</span></a>
                </li>
            
        </ul>
    </section>
    <section class="main-aside-section aside">
        <h1 class="aside-title">标签</h1>
        <ul class="aside-list">
            
                <li class="aside-list-item">
                    <a class="ali-text u-cf" href="/tags/Angular/">Angular&nbsp;<span class="ali-count u-hightLightText">1</span></a>
                </li>
            
                <li class="aside-list-item">
                    <a class="ali-text u-cf" href="/tags/英文小说/">英文小说&nbsp;<span class="ali-count u-hightLightText">4</span></a>
                </li>
            
                <li class="aside-list-item">
                    <a class="ali-text u-cf" href="/tags/DOM/">DOM&nbsp;<span class="ali-count u-hightLightText">1</span></a>
                </li>
            
                <li class="aside-list-item">
                    <a class="ali-text u-cf" href="/tags/RequireJS/">RequireJS&nbsp;<span class="ali-count u-hightLightText">1</span></a>
                </li>
            
                <li class="aside-list-item">
                    <a class="ali-text u-cf" href="/tags/Zepto/">Zepto&nbsp;<span class="ali-count u-hightLightText">1</span></a>
                </li>
            
                <li class="aside-list-item">
                    <a class="ali-text u-cf" href="/tags/自控力/">自控力&nbsp;<span class="ali-count u-hightLightText">1</span></a>
                </li>
            
                <li class="aside-list-item">
                    <a class="ali-text u-cf" href="/tags/Sketch/">Sketch&nbsp;<span class="ali-count u-hightLightText">1</span></a>
                </li>
            
                <li class="aside-list-item">
                    <a class="ali-text u-cf" href="/tags/足球/">足球&nbsp;<span class="ali-count u-hightLightText">1</span></a>
                </li>
            
                <li class="aside-list-item">
                    <a class="ali-text u-cf" href="/tags/世界杯/">世界杯&nbsp;<span class="ali-count u-hightLightText">1</span></a>
                </li>
            
                <li class="aside-list-item">
                    <a class="ali-text u-cf" href="/tags/上班/">上班&nbsp;<span class="ali-count u-hightLightText">1</span></a>
                </li>
            
                <li class="aside-list-item">
                    <a class="ali-text u-cf" href="/tags/租房/">租房&nbsp;<span class="ali-count u-hightLightText">1</span></a>
                </li>
            
        </ul>
    </section>
</aside>
        
    </main>
    <div class="bg-global" style="background-image: url('image/bg-default.jpg')"></div>
    <footer class="foot">
        <span class="foot-text">&spades;&nbsp;sunaiwen - 2015&nbsp;&clubs;&nbsp;Power by hexo&nbsp;&spades;</span>
    </footer>
    <script src="/js/lib/highlight.js"></script>
<script src="/js/app.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-51163552-1', 'auto');
    ga('send', 'pageview');
</script>



    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    var duoshuoQuery = {short_name:"sunaiwen"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
</script>
<!-- 多说公共JS代码 end -->

</body>
</html>